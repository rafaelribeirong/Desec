**Descobrindo Hosts Através do Protocolo ARP para Pentest Interno**

- **Requisitos**:  
  - Você precisa estar fisicamente conectado ao ponto de rede (via cabo ou Wi-Fi).
  - O cliente contratou para realizar o pentest **localmente**. Não é um pentest para ser feito remotamente nem por VPN.
  - A descoberta de hosts será feita utilizando o **protocolo ARP** (Address Resolution Protocol), que é usado para mapear endereços IP para endereços MAC dentro da rede local (LAN).

- **Observações**:  
  - **ARP** funciona apenas dentro da rede local (sub-rede), ou seja, não é possível realizar a descoberta de hosts remotamente.
  - O **pentest interno** requer que você esteja fisicamente presente no local, conectado diretamente ao ponto de rede da organização.

![[Pasted image 20241117130055.png]]


**Cenário**:

- Existe uma **regra de firewall** bloqueando o **ICMP**, o que impede a utilização do comando `ping` para identificar hosts na rede.
- Você já utilizou um script para realizar o **ping sweep**, mas não obteve retorno, pois o ICMP está bloqueado.
- Vamos usar o **protocolo ARP** para tentar identificar a máquina na rede, já que o ARP não é bloqueado pelo firewall.

**Estratégia com ARP**:

1. Uma das técnicas para identificar hosts ativos na rede, mesmo com o ICMP bloqueado, é utilizar o **arping**. 
   - O **arping** envia uma requisição ARP para um endereço IP e, se o host estiver ativo, ele responderá com seu endereço MAC.
   - O comando a seguir pode ser utilizado para fazer uma varredura simples nos IPs de uma sub-rede:

```bash
for ip in $(seq 1 14); do arping -c 1 192.168.0.$ip; done | grep "60 bytes"
```

**Explicação**:
- `for ip in $(seq 1 14); do arping -c 1 192.168.0.$ip; done`: Esse comando vai testar os IPs de `192.168.0.1` a `192.168.0.14`, enviando uma única requisição ARP (`-c 1`) para cada IP.
- `grep "60 bytes"`: Filtra apenas as respostas que indicam que o host respondeu à requisição ARP. A resposta contém "60 bytes" quando o host é encontrado.

2. **Alternativa com arpscan**:
   - Uma ferramenta muito útil para varredura de ARP é o **arp-scan**. Ela realiza uma varredura automática de todos os dispositivos na rede local e retorna os hosts ativos.
   
   Com o comando a seguir, você pode obter uma lista de todos os dispositivos na sua rede local:

```bash
arp-scan -l
```

**Explicação**:
- `arp-scan -l`: Esse comando faz uma varredura em todos os segmentos de rede locais e retorna uma lista de todos os hosts ativos, com seus respectivos endereços IP e MAC.